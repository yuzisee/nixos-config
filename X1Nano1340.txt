## Hardware
I only ever use between 50~75GB for the NixOS partition (mounted as XFS at `/nix`)
The rest you could use (currently 280GB but we can easily delete some stuff) mounted as EXT4 at `/`)

Device              Start        End    Sectors   Size Type
/dev/nvme0n1p1       2048     534527     532480   260M EFI System
/dev/nvme0n1p2     534528     567295      32768    16M Microsoft reserved
/dev/nvme0n1p3     567296   42510335   41943040    20G Linux swap
/dev/nvme0n1p4 1998360576 2000408575    2048000  1000M Windows recovery environment
/dev/nvme0n1p5   42510336   44607487    2097152     1G EFI System
/dev/nvme0n1p6   44607488  581478399  536870912   100G Linux filesystem
/dev/nvme0n1p7  581478400 1998360575 1416882176 300+G Linux filesystem

### Verdict

**Resize 1**
We'll use 799557MiB EXT4 for the main partition.
We'll keep the rest (~160GiB) as XFS mounted to /nix

**Resize 2**
Then, take down to 798533MiB
leaving 1024 MiB as /boot (FAT32)


----

Recovery steps

```sh
sudo mkdir -v /home/separate_copy
sudo chown joseph:users /home/separate_copy
cd
mv -v Dropbox Movies Downloads /home/separate_copy
mv -v .cache /tmp
# [!NOTE]
# You can probably skip `~/screenshots` too, I doubt we need those
mkdir -v /path/to/ext4/location
sudo chown joseph:users /path/to/ext4/location
rsync -avAX ./ /path/to/ext4/location
# This requires about 100MiB for Documents + ~2GiB of hidden files (900MiB for .mozilla + 400MiB for .librewolf) + 
mv -v ~/separate_copy/Downloads/_complete /tmp
mv -v ~/separate_copy/Movies/_complete/* /tmp
mv -v ~/separate_copy/Downloads /path/to/backup/location (~60GiB, usually vfat)
mv -v ~/separate_copy/Movies /path/to/backup/location (~5GiB, usually vfat)
```

Look out for:
~/.nix-profile (symlink)

Optionally restore:
reboot.txt (symlink)

---

# Prerequisites
- Update by downloading and running Ventoy2Disk.sh if you are on an old version of Ventoy prior to the SBAT key changes. If you are able to get in even with SecureBoot on (at least, to the MOK step) you are all good
- The OEM shipped this machine on the 6.14 Linux kernel, so we'll choose the live USB environment that is closest to that.
- Alas, even if Ventoy supports SecureBoot (and can get into NixOS when running Ventoy grub2 mode) the NixOS operating system itself does not yet support SecureBoot
  - https://github.com/NixOS/nixpkgs/issues/255643
  - https://github.com/NixOS/nixpkgs/issues/42127

## Basic things you'll probably figure out
nmtui connects to the internet
gh is the easiest git authentication (you'll also need git)
I added vim-full for convenience.

### READY!

Install latest NixOS from scratch
* sudo mkdir -v /opt/nixos-config
* sudo chown joseph:wheel /opt/nixos-config
* cd /opt/nixos-config; git clone 'https://github.com/yuzisee/nixos-config.git' .; git config user.name 'Joseph Huang'; git config user.email 'yuzisee+github@gmail.com'
* mkdir -v X1Nano1340_v3.etc_nixos
* mkdir -v X1Nano1340_v3.home
* sudo chown root:wheel X1Nano1340_v3.etc_nixos
